# Requirements Document

## はじめに

mitos（ミトス）は、Git worktreeの作成・管理とPTY（擬似端末）を使用したターミナルエミュレーションを統合したCLI/TUIツールです。

最速MVPは、最小限のworktree管理機能（作成・一覧表示・削除）とPTYベースのシェル起動機能に絞り込み、設定ファイル無しで即座に動作する実装を目指します。

## 要件

### 要件 1: Git Worktree管理機能
**ユーザーストーリー:** 開発者として、Git worktreeを簡単に作成・管理できることで、複数の作業を並行して効率的に進めたい

#### 受入基準

1. WHEN ユーザーがworktree一覧表示コマンドを実行する THEN システムは現在のリポジトリの全worktree（パス、ブランチ名、HEAD commit）を表示する
2. WHEN ユーザーが新規worktree作成を要求する AND ブランチ名を指定する THEN システムは指定されたブランチ用の新しいworktreeを作成する
3. IF worktreeパスが既に存在する THEN システムはエラーメッセージを表示して作成を中断する
4. WHEN ユーザーがworktree削除を要求する THEN システムは確認プロンプトを表示する
5. WHEN ユーザーが削除を確認する THEN システムは指定されたworktreeを削除する
6. WHERE worktreeがロックされている状態で削除が要求される THE システムは警告メッセージを表示する

### 要件 2: PTYベースターミナルエミュレーション
**ユーザーストーリー:** 開発者として、選択したworktreeディレクトリでシェルを即座に起動できることで、コンテキストスイッチをスムーズに行いたい

#### 受入基準

1. WHEN ユーザーがworktreeを選択してシェル起動を要求する THEN システムはそのworktreeディレクトリをカレントディレクトリとしてPTYシェルを起動する
2. WHILE PTYシェルが起動している間 THE システムはキー入力をシェルプロセスへ転送する
3. WHILE PTYシェルが起動している間 THE システムはシェルプロセスからの出力をターミナルに表示する
4. WHEN ターミナルウィンドウがリサイズされる THEN システムはPTYプロセスに新しいウィンドウサイズを伝播する
5. WHEN ユーザーがシェル終了コマンドを入力する OR Ctrl+Dを押す THEN システムはPTYセッションを適切に終了する
6. IF PTYプロセスが異常終了する THEN システムはエラーメッセージを表示してRaw modeを確実に解除する

### 要件 3: TUIインターフェース
**ユーザーストーリー:** 開発者として、直感的なTUIを通じてworktreeを視覚的に管理できることで、コマンドを覚える必要なく操作したい

#### 受入基準

1. WHEN TUIが起動する THEN システムはAlternate Screenバッファーを有効化して通常の端末出力と分離する
2. WHEN TUIが表示される THEN システムはworktree一覧、選択中のworktree、操作ヒントを含む単一ペインUIを表示する
3. WHEN ユーザーが上下矢印キーを押す THEN システムは選択されたworktreeをハイライト表示して移動する
4. WHEN ユーザーがEnterキーを押す AND worktreeが選択されている THEN システムはそのworktreeでPTYシェルを起動する
5. WHEN ユーザーがqキーまたはEscキーを押す THEN システムはTUIを終了してRaw modeを解除する
6. IF TUIが異常終了する THEN システムは端末を通常の状態に復元する
7. WHILE TUIが実行中 THE システムはターミナルリサイズイベントに応答してUIを再描画する

### 要件 4: CLIインターフェース
**ユーザーストーリー:** 開発者として、慣れ親しんだコマンドラインからworktree操作を実行できることで、スクリプト化や自動化を行いたい

#### 受入基準

1. WHEN ユーザーが`mitos list`を実行する THEN システムは全worktreeを表形式で標準出力に表示する
2. WHEN ユーザーが`mitos create <branch-name>`を実行する THEN システムは新しいworktreeを作成して成功メッセージを表示する
3. WHEN ユーザーが`mitos open <worktree-path>`を実行する THEN システムは指定されたworktreeでシェルを起動する
4. WHEN ユーザーが`mitos remove <worktree-path>`を実行する THEN システムは確認後にworktreeを削除する
5. WHEN ユーザーが`--help`フラグを付けて実行する THEN システムは使用可能なコマンドとオプションのヘルプを表示する
6. IF 無効なコマンドまたは引数が提供される THEN システムは適切なエラーメッセージとヘルプヒントを表示する

### 要件 5: エラー処理とログ
**ユーザーストーリー:** 開発者として、問題が発生した際に詳細なエラー情報を得られることで、迅速にトラブルシューティングを行いたい

#### 受入基準

1. WHEN エラーが発生する THEN システムは人間が理解しやすいエラーメッセージを表示する
2. IF gitコマンドが失敗する THEN システムはgitのエラーメッセージを表示する
3. WHEN パニックが発生する THEN システムは端末状態を復元する